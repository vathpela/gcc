! { dg-do run }
! { dg-options "-O2" }
! This test from PR123947. Adapted from Fujitsu 0583_0023.f90

MODULE MOD1
TYPE NODE
INTEGER,ALLOCATABLE :: VALUE
TYPE (NODE), ALLOCATABLE :: NEXT_NODE(:)
END TYPE

TYPE TY
TYPE(NODE),ALLOCATABLE :: OBJ1(:)
TYPE(NODE),ALLOCATABLE :: OBJ2(:)
END TYPE
END MODULE

CALL SUB()

CONTAINS
SUBROUTINE SUB()
USE MOD1
TYPE(TY)::BASE

ALLOCATE(BASE%OBJ2(6))
ALLOCATE(BASE%OBJ2(3)%VALUE)
ALLOCATE(BASE%OBJ2(5)%VALUE)

ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(2))
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(3))
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(1)%NEXT_NODE(2))
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(2)%NEXT_NODE(3))
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(3)%NEXT_NODE(4))
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(2)%NEXT_NODE(5))
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(2)%NEXT_NODE(2)%NEXT_NODE(5))

ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(2)%VALUE)
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(2)%VALUE)
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(2)%NEXT_NODE(3)%VALUE)
ALLOCATE(BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(1)%NEXT_NODE(2)%VALUE)

BASE%OBJ2(3)%VALUE = 21
BASE%OBJ2(5)%VALUE = 22
BASE%OBJ2(5)%NEXT_NODE(2)%VALUE = 23
BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(2)%VALUE = 24
BASE%OBJ2(5)%NEXT_NODE(2)%NEXT_NODE(3)%VALUE = 25
BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(1)%NEXT_NODE(2)%VALUE = 26

ALLOCATE(BASE%OBJ1, SOURCE = BASE%OBJ2(3:5))

BASE%OBJ2(3)%VALUE = 31
BASE%OBJ2(5)%VALUE = 32
BASE%OBJ2(5)%NEXT_NODE(2)%VALUE = 33
BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(2)%VALUE = 34
BASE%OBJ2(5)%NEXT_NODE(2)%NEXT_NODE(3)%VALUE = 35
BASE%OBJ2(5)%NEXT_NODE(1)%NEXT_NODE(1)%NEXT_NODE(2)%VALUE = 36

if (BASE%OBJ1(1)%VALUE /= 21) stop 101
if (BASE%OBJ1(3)%VALUE /= 22) stop 102
if (BASE%OBJ1(3)%NEXT_NODE(2)%VALUE /= 23) stop 103
if (BASE%OBJ1(3)%NEXT_NODE(1)%NEXT_NODE(2)%VALUE /= 24) stop 104
if (BASE%OBJ1(3)%NEXT_NODE(2)%NEXT_NODE(3)%VALUE /= 25) stop 105
if (BASE%OBJ1(3)%NEXT_NODE(1)%NEXT_NODE(1)%NEXT_NODE(2)%VALUE /= 26) stop 106

if (SIZE(BASE%OBJ1(3)%NEXT_NODE) /= 2) stop 201
if (SIZE(BASE%OBJ1(3)%NEXT_NODE(1)%NEXT_NODE) /= 3) stop 202
if (SIZE(BASE%OBJ1(3)%NEXT_NODE(1)%NEXT_NODE(1)%NEXT_NODE) /= 2) stop 203
if (SIZE(BASE%OBJ1(3)%NEXT_NODE(1)%NEXT_NODE(2)%NEXT_NODE) /= 3) stop 204
if (SIZE(BASE%OBJ1(3)%NEXT_NODE(1)%NEXT_NODE(3)%NEXT_NODE) /= 4) stop 205
if (SIZE(BASE%OBJ1(3)%NEXT_NODE(2)%NEXT_NODE) /= 5) stop 206
if (SIZE(BASE%OBJ1(3)%NEXT_NODE(2)%NEXT_NODE(2)%NEXT_NODE) /= 5) stop 207

END SUBROUTINE

END
